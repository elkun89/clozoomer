<!DOCTYPE html>

<html lang="en">
{% load staticfiles %}
	<head>
		<title>Clozoom</title>
		<meta charset="utf-8">
		<link rel="stylesheet" href="{% static "css/theme.css" %}" type="text/css" media="screen"/>
		<script src="{% static "js/jquery.js" %}"></script>
		<!-- <script src="{% static "js/functions.js" %}" ></script> -->
		<script src="{% static "js/highlight.js" %}"></script>
		<!-- Author: Kun Peng -->
	</head>

<script>

function show_livefeed(){
		$.ajax({
		type: 'GET',
		url: '/getPosts',
		contentType: "application/json",
		success: function(data) {
			var insert = 'Posts: <br>';
			for (var i = 0; i < data.length; i++) {
			    insert = insert + data[i].author + ": " + 
				"<img src = '/media/" + data[i].mainPicture + "' HEIGHT='200' WIDTH='138' BORDER='1'>" + 
				"<img src = '/media/" + data[i].userPictures + "' HEIGHT='200' WIDTH='138' BORDER='1'>" + "<br>";
			}
			$("#main_board").html(insert);
		},
		error: function(e) {
			alert('error!');
		}
	});
};

function getTypeData(id){	
	var insert = "";
	var apparelData;
	$.ajax({
		type: 'GET',
		url: '/getApparelType/' + id + '/',
		async : false,
		contentType: "application/json",
		success: function(data) {
			apparelData = data;
			// insert = insert + "Name: " + apparelName + "<br>";
			// $("#apparelType").append(insert);
		},
		error: function(e) {
			alert('error!');
		}
	});
	return apparelData;
};

function getLocationName(id){	
	var insert = "";
	var locationName;
	$.ajax({
		type: 'GET',
		url: 'rest/locations/' + id + '/',
		async : false,
		contentType: "application/json",
		success: function(data) {
			locationName = data.address;
		},
		error: function(e) {
		}
	});
	return locationName;
};

function apparel_request(){
	var clear = '';
	$("#main_board").html(clear);
	$.ajax({
		type: 'GET',
		url: '/apparel',
		contentType: "application/json",
		success: function(data) {
			var apparelName;
			var locationName;
			var insert = "List of User's Apparel: <br>";
			for (var i = 0; i < data.length; i++) {
				apparelName = getTypeData(data[i].type).name;
				locationName = getLocationName(data[i].locationOfPurchase);	
				insert = insert + "Name: " + apparelName + "<br>";
			    insert = insert + "Purchase Time: " + data[i].timeOfCreation + "<br>";
			    insert = insert + "Location: " + locationName + "<br>";

			    // $("#apparel").append($("apparelType"), $(apparelInstance));
			    // $("#apparelType").clear;
			    // $("#apparelInstance").clear;
			}
			$("#main_board").html(insert);
		},
		error: function(e) {
		}
	});
};

function category_request(){
	$.ajax({
		type: 'GET',
		url: '/categories',
		contentType: "application/json",
		success: function(data) {
			var insert = '';
			for (var i = 0; i < data.length; i++) {
			    insert = insert + data[i].name + "<br>";
			}
			$("#categories").html(insert);
		},
		error: function(e) {
		}
	});
};

function friends_request(){
	var clear = '';
	$("#main_board").html(clear);
	$.ajax({
		type: 'GET',
		url: '/getFriends',
		contentType: "application/json",
		success: function(data) {
			var insert = 'Friends: <br>';
			for (var i = 0; i < data.length; i++) {
			    insert = insert + "Name: " + data[i].first_name + " " + data[i].last_name + "<br>";
			    insert = insert + "Email: " + data[i].email + "<br>";
			}
			$("#main_board").html(insert);
		},
		error: function(e) {
			alert('error!');
		}
	});
};

function profile_request(){
	$.ajax({
		type: 'GET',
		url: '/userProfile',
		contentType: "application/json",
		success: function(data) {
			var insert = 'Profile: <br>';
			for (var i = 0; i < data.length; i++) {
			    insert = insert + "Username: " + data[i].username + "<br>";
			    insert = insert + "Email: " + data[i].email + "<br>";
			}
			$("#profile").html(insert);
		},
		error: function(e) {
		}
	});
}

function apparel_nojson_request(){
	var clear = '';
	$("#main_board").html(clear);
	var insert = '{% for a in usrApparel %}Name : {{a.type.name}} <br>Time Added to Closet: {{a.timeOfCreation}} <br> Image: ';
	insert = insert + '<img src = "/media/{{a.type.pictureLink}}" HEIGHT="145" WIDTH="145" BORDER="1"> <br><br>{% endfor %}'
	$("#main_board").html(insert);
}

function show_profilepic(){
	var clear = '';
	$("#profilepic_photo").html(clear);

	$.ajax({
		type: 'GET',
		url: 'getFriends',
		contentType: "application/json",
		success: function(data) {
			alert(data[0].email);
			var insert = '';
			insert = insert + '<img src = "../static/images/';
			insert = insert + data[0].profilePictureLink;
			insert = insert + '" HEIGHT="200" WIDTH="138" BORDER="1">';
			$("#profilepic_photo").html(insert);
		},
		error: function(e) {
			alert(e);
		}
	});
}

function show_closet(){
		$.ajax({
		type: 'GET',
		url: '/getCloset',
		contentType: "application/json",
		success: function(data) {
			var insert = 'My Closet: <br>';
			for (var i = 0; i < data.length; i++) {
			    insert = insert + data[i].author + ": " + 
				"<img src = '/media/" + data[i].mainPicture + "' HEIGHT='200' WIDTH='138' BORDER='1'>" + 
				"<img src = '/media/" + data[i].userPictures + "' HEIGHT='200' WIDTH='138' BORDER='1'>" + "<br>";
			}
			$("#main_board").html(insert);
		},
		error: function(e) {
			alert('error!');
		}
	});
};

function create_post(){
		$.ajax({
		type: 'GET',
		url: '/newPost',
		success: function(data) {
			$("#main_board").html(data);
		},
		error: function(e) {
			alert('error!');
		}
	});
};

function add_apparel(){
		$.ajax({
		type: 'GET',
		url: '/addApparelInstance',
		success: function(data) {
			$("#main_board").html(data);
		},
		error: function(e) {
			alert('error!');
		}
	});
};

$(document).ready(function(){
	show_livefeed();
});

</script>

	<body>
		<div id = "leftpart">
			<section id="profilepic_section">
				<div id = 'profilepic_photo'>
					<img src = "{{thisProfile.profilePictureLink.url}}" HEIGHT="145" WIDTH="145" BORDER="1">
					<!-- <img src = "{{thisProfile.profilePictureLink}}"> -->
				</div>
				<p>{{thisUser.first_name}} {{thisUser.last_name}}</p>
				<p><a class = "button" id ="edit" href="/editProfile">Edit Profile</a></p>
			</section>
		
			<section id="sidebar">
				<h4>Current Trends</h4>
				<p> XXX </p>
				<p> XXX </p>
				<p> XXX </p>
				<br />
				<br />
				<br />
				<h4>Followed Trends</h4>
				<p> XXX </p>
				<p> XXX </p>
				<p> XXX </p>
			</section>
		</div>
		
		<div id = "rightpart">
			<section id="main_content">
				<div>
					<menu id = "thumbnails">
                                            <ul>
						<li><input class = "button" type="button" onclick="show_livefeed();" value="Stream" /></li>
						<li><input class = "button" type="button" onclick="apparel_nojson_request();" value="Closet" /></li>
						<li><input class = "button" type="button" onclick="friends_request();" value="Followers" /></li>
						<li><input class = "button" type="button" onclick="create_post();" value="New Post" /></li>
						<li><input class = "button" type="button" onclick="add_apparel();" value="Add Apparel" /></li>
						<li><a class = "button" href="/accounts/logout/">Log Out</a></li>
                                            </ul>
				</div>
				<div id = "main_board" >
				</div>
				<div id = "test_board" >
				</div>
			</section>
		</div>
	</body>
</html>

